---
import Layout from "../layouts/Layout.astro";
---

<Layout title="buttons galore">
  <h1>buttons galore!</h1>
  my personal collection of 88x31 buttons (that you can contribute to), all in one place!
  <a href="https://github.com/ThinLiquid/buttons">github repo</a>

  <div class="tooltip" style={{ position: 'absolute', background: 'var(--base)', zIndex: 69696969, padding: '5px', border: '2px dashed var(--surface0)', borderRadius: '5px' }}></div>

  <input type="text" id="search" placeholder="search for a button..." style={{ width: '100%' }} />

  <div style={{ display: 'flex' }}>
    <label for="categories"></label>
    <select id="categories" style={{ flex: 1 }}>
      <option>All Categories</option>
    </select>
    <label for="sort"></label>
    <select id="sort" style={{ flex: 1 }}>
      <option value="alphabetical">Alphabetical</option>
      <option value="alphabetical-reverse">Alphabetical (Reverse)</option>
      <option value="order">Order</option>
      <option value="order-reverse">Order (Reverse)</option>
      <option value="random">Random</option>
    </select>
    <label for="creators"></label>
    <select id="creators" style={{ flex: 1 }}>
      <option>All Creators</option>
    </select>
  </div>

  <div class="buttons"></div>
</Layout>

<style>
  .dimmed::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    pointer-events: none;
  }

  .buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
    justify-content: center;
    position: relative;
  }

  .button-img {
    width: 88px;
    height: 31px;
    position: relative;
    transition: opacity 0.2s;
  }
</style>

<script>
  const BUTTON_FILE = 'https://raw.githubusercontent.com/ThinLiquid/buttons/main/index.buttonfile';
  const BUTTON_DIRECTORY = 'https://raw.githubusercontent.com/ThinLiquid/buttons/main/img/';

  const fetchButtons = async () => {
    const res = await fetch(`${BUTTON_FILE}`, { cache: 'no-store' });
    const data = await res.text();
    const entries = data.split('\n').map((entry, index) => {
      const [categories, tags, filename, description, creator] = entry.split(' | ');
      try {
        return {
          categories: categories?.split(',') || [],
          tags: tags?.split(' ') || [],
          filename,
          description,
          creator: creator || 'N/A'
        };
      } catch {
        console.error('Error: malformed content\n ->', JSON.stringify(entry), 'at line', index);
        return null;
      }
    }).filter(entry => entry !== null);

    return entries;
  };

  const renderButtons = (buttons) => {
    const buttonsContainer = document.querySelector('.buttons');
    buttonsContainer.innerHTML = '';

    buttons.forEach(button => {
      const buttonElement = document.createElement('img');
      buttonElement.src = `${BUTTON_DIRECTORY}${button.filename}`;
      buttonElement.alt = button.description;
      buttonElement.classList.add('button-img');

      buttonElement.addEventListener('mouseover', () => showTooltip(button));
      buttonElement.addEventListener('mouseout', hideTooltip);

      buttonsContainer.appendChild(buttonElement);
    });
  };

  const applyFilter = () => {
    const searchValue = search.value.toLowerCase();
    const category = categoriesSelect.value;
    const creator = creatorsSelect.value;

    document.querySelectorAll('.button-img').forEach(button => {
      const { categories, tags, description, creator } = button.dataset;
      const matches =
        (category === 'All Categories' || categories.includes(category)) &&
        (creator === 'All Creators' || creator === button.dataset.creator) &&
        (description.toLowerCase().includes(searchValue) || tags.includes(searchValue));
      
      button.classList.toggle('dimmed', !matches);
    });
  };

  const init = async () => {
    const buttons = await fetchButtons();
    renderButtons(buttons);

    search.addEventListener('input', applyFilter);
    categoriesSelect.addEventListener('change', applyFilter);
    creatorsSelect.addEventListener('change', applyFilter);
  };

  init();
</script>
<style>
  .hidden {
    display: none;
  }
</style>
<style>
  .buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0px;
    margin-top: 10px;
    justify-content: center;

    img {
      transition: scale .2s var(--bounce), rotate .2s var(--bounce);
      &:hover {
        z-index: 6969;
        scale: 1.5;

        &:nth-child(even) {
          rotate: 2deg;
        }

        &:nth-child(odd) {
          rotate: -2deg;
        }
      }
    }
  }
</style>
<style is:global>
  content .tooltip {
    visibility: hidden;
  }

  content:hover .tooltip {
    visibility: visible;
  }

  body, html {
    overflow-x: hidden;
  }
</style>
